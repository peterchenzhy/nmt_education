<page-header [title]="'报名信息'"></page-header>
<form nz-form [formGroup]="form" (ngSubmit)="_submitForm()" [nzLayout]="'vertical'">
    <nz-card [nzHoverable]="true" [nzBordered]="false">
        <sv-container size="large" title="学生信息">
            <sv label="姓名">{{order.student.name}}</sv>
            <sv label="性别">{{ globalService.getGenderLabel(order.student.sex)}}</sv>
            <sv label="出生年月">{{order.student.birthday}}</sv>
            <sv label="联系电话">{{order.student.phone}}</sv>
            <sv label="学校">{{order.student.school}}</sv>
            <sv label="备注" col="1">{{order.student.remark}}</sv>
        </sv-container>
        <nz-divider></nz-divider>
        <sv-container size="large" title="课程信息">
            <sv *ngIf="order.course.code != null" label="课程名">{{order.course.name}}
                [{{order.course.year+order.course.season}}]
                <i nz-icon nzType="swap" nzTheme="outline" style="color:blue;margin-left:15px;" title="重新选择课程" (click)="clearSelectedCourse()"></i>
            </sv>
            <sv *ngIf="order.course.code == null" label="课程名" nz-form-control nzErrorTip="请选择课程">
                <nz-select formControlName="courseCode" class="enroll-selector" nzShowSearch nzServerSearch
                    nzPlaceHolder="输入课程编号或课程名称" [nzShowArrow]="false" [nzFilterOption]="nzFilterOption"
                    [nzDropdownMatchSelectWidth]="false" (nzOnSearch)="search($event)" (ngModelChange)="courseSelected($event)">
                    <nz-option *ngFor="let o of listOfOption" nzCustomContent [nzLabel]="o.name" [nzValue]="o.code">
                        <div style="width: 100px; float: left;">{{o.code}}</div>
                        <div style="width: 100px; float: left">{{o.name}}</div>
                        <div style="width: 30px; float: left">{{globalService.getCourseSubjectLabel(o.subject)}}</div>
                    </nz-option>
                </nz-select>
            </sv>
            <sv label="科目">{{globalService.getCourseSubjectLabel(order.course.subject)}}</sv>
            <sv label="开课日期">{{order.course.startDate}}</sv>
            <sv label="年级">{{globalService.getGradeLabel(order.course.grade)}}</sv>
            <sv label="类型">{{globalService.getCourseTypeLabel(order.course.type)}}</sv>
            <sv label="助教老师">{{order.course.assistant}}</sv>
            <sv label="校区">{{globalService.getCampusLabel(order.course.campus)}}</sv>
        </sv-container>
        <nz-divider></nz-divider>
        <div class="text-lg mb-md">支付信息</div>
        <nz-table formArrayName="payList" [nzData]="payList.value" [nzShowPagination]="false">
            <thead>
                <tr>
                    <th>费用类型</th>
                    <th>原价</th>
                    <th>折扣系数</th>
                    <th>余额抵扣</th>
                    <th>应付</th>
                    <th>实付</th>
                    <th>支付方式</th>
                    <th>支付状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of payList.controls; let i = index" [formGroupName]="i">
                    <td>
                        <span nz-form-control nzErrorTip="请选费用类型">
                            <nz-select formControlName="type" [nzPlaceHolder]="'请选费用类型'" [nzShowSearch]="true">
                                <nz-option *ngFor="let i of feeTypeList" [nzLabel]="i.label" [nzValue]="i.value">
                                </nz-option>
                            </nz-select>
                        </span>
                    </td>
                    <td>
                        <span>{{ payList.value[i].price }}</span>
                    </td>
                    <td>
                        <span nz-form-control>
                            <nz-input-number formControlName="discount" placeholder="1"></nz-input-number>
                        </span>
                    </td>
                    <td>
                        <span nz-form-control>
                            <nz-input-number formControlName="deduction" placeholder="0"></nz-input-number>
                        </span>
                    </td>
                    <td>
                        <span>{{ payList.value[i].receivable }}</span>
                    </td>
                    <td>
                        <span nz-form-control>
                            <nz-input-number formControlName="paied" placeholder="0"></nz-input-number>
                        </span>
                    </td>
                    <td>
                        <span nz-form-control nzErrorTip="请选支付方式">
                            <nz-select formControlName="method" [nzPlaceHolder]="'请选支付方式'" [nzShowSearch]="true">
                                <nz-option *ngFor="let i of payMethodList" [nzLabel]="i.label" [nzValue]="i.value">
                                </nz-option>
                            </nz-select>
                        </span>
                    </td>
                    <td>
                        <span nz-form-control>
                            <nz-select formControlName="status" [nzPlaceHolder]="'请选支付状态'" [nzShowSearch]="true">
                                <nz-option *ngFor="let i of payStatusList" [nzLabel]="i.label" [nzValue]="i.value">
                                </nz-option>
                            </nz-select>
                        </span>
                    </td>
                    <td>
                        <span>
                            <a nz-popconfirm nzPopconfirmTitle="是否要删除此行？" (nzOnConfirm)="delFee(i)">删除</a>
                        </span>
                    </td>
                </tr>
            </tbody>
        </nz-table>
        <button *ngIf="editFeeIndex === -1" nz-button [nzType]="'dashed'" (click)="addFee()" nzBlock class="mt-md">
            <i nz-icon nzType="plus"></i>
            <span>新增费用</span>
        </button>
        <!-- <div class="text-lg my-md">课时列表</div>
        <st [data]="order.sessionList" [columns]="sessionListColumns" [page]="{ show: false }"></st> -->
    </nz-card>
    <footer-toolbar errorCollect>
        <button nz-button type="primary" nzType="primary">提交</button>
    </footer-toolbar>
</form>
